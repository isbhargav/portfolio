<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Neural Network from Scratch using Numpy | AI Portforlio</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Neural Network from Scratch using Numpy" />
<meta name="author" content="Bhargav Lad" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We will replicate pytorch functionalities using only Numpy" />
<meta property="og:description" content="We will replicate pytorch functionalities using only Numpy" />
<link rel="canonical" href="https://isbhargav.github.io/portfolio/jupyter/neural-network/numpy/2021/01/18/multi-class-classification.html" />
<meta property="og:url" content="https://isbhargav.github.io/portfolio/jupyter/neural-network/numpy/2021/01/18/multi-class-classification.html" />
<meta property="og:site_name" content="AI Portforlio" />
<meta property="og:image" content="https://isbhargav.github.io/portfolio/images/nn_numpy.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-18T00:00:00-06:00" />
<script type="application/ld+json">
{"url":"https://isbhargav.github.io/portfolio/jupyter/neural-network/numpy/2021/01/18/multi-class-classification.html","@type":"BlogPosting","headline":"Neural Network from Scratch using Numpy","dateModified":"2021-01-18T00:00:00-06:00","datePublished":"2021-01-18T00:00:00-06:00","author":{"@type":"Person","name":"Bhargav Lad"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://isbhargav.github.io/portfolio/jupyter/neural-network/numpy/2021/01/18/multi-class-classification.html"},"image":"https://isbhargav.github.io/portfolio/images/nn_numpy.png","description":"We will replicate pytorch functionalities using only Numpy","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/portfolio/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://isbhargav.github.io/portfolio/feed.xml" title="AI Portforlio" /><link rel="shortcut icon" type="image/x-icon" href="/portfolio/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/portfolio/">AI Portforlio</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/portfolio/about/">About Me</a><a class="page-link" href="/portfolio/search/">Search</a><a class="page-link" href="/portfolio/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Neural Network from Scratch using Numpy</h1><p class="page-description">We will replicate pytorch functionalities using only Numpy</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-01-18T00:00:00-06:00" itemprop="datePublished">
        Jan 18, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Bhargav Lad</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/portfolio/categories/#jupyter">jupyter</a>
        &nbsp;
      
        <a class="category-tags-link" href="/portfolio/categories/#neural-network">neural-network</a>
        &nbsp;
      
        <a class="category-tags-link" href="/portfolio/categories/#numpy">numpy</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/isbhargav/portfolio/tree/master/_notebooks/2021-01-18-multi-class-classification.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/portfolio/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/isbhargav/portfolio/master?filepath=_notebooks%2F2021-01-18-multi-class-classification.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/portfolio/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/isbhargav/portfolio/blob/master/_notebooks/2021-01-18-multi-class-classification.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/portfolio/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Multi-Class-classification">Multi Class classification </a></li>
<li class="toc-entry toc-h1"><a href="#Libraries-used">Libraries used </a></li>
<li class="toc-entry toc-h1"><a href="#Loading-dataset">Loading dataset </a></li>
<li class="toc-entry toc-h1"><a href="#Train-Test-split">Train Test split </a></li>
<li class="toc-entry toc-h1"><a href="#Neural-Network--Layers">Neural Network  Layers </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Linear-Layer">Linear Layer </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Relu-Activation">Relu Activation </a></li>
<li class="toc-entry toc-h1"><a href="#Loss-function">Loss function </a></li>
<li class="toc-entry toc-h1"><a href="#Model-Class">Model Class </a></li>
<li class="toc-entry toc-h1"><a href="#Score-function/metric">Score function/metric </a></li>
<li class="toc-entry toc-h1"><a href="#Training-Loop">Training Loop </a></li>
<li class="toc-entry toc-h1"><a href="#Evaluation-on-test-set">Evaluation on test set </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-01-18-multi-class-classification.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Multi-Class-classification">
<a class="anchor" href="#Multi-Class-classification" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multi Class classification<a class="anchor-link" href="#Multi-Class-classification"> </a>
</h1>
<p><strong>Dataset</strong></p>
<p>The data set contains 3 classes of 50 instances each, where each class refers to a type of iris plant. One class is linearly separable from the other 2; the latter are NOT linearly separable from each other.</p>
<p><strong>Attribute Information:</strong></p>
<ol>
<li>sepal length in cm</li>
<li>sepal width in cm</li>
<li>petal length in cm</li>
<li>petal width in cm</li>
<li>class:
<pre><code>1. Iris Setosa
2. Iris Versicolour
3. Iris Virginica</code></pre>
</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn.datasets</span> <span class="k">as</span> <span class="nn">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Libraries-used">
<a class="anchor" href="#Libraries-used" aria-hidden="true"><span class="octicon octicon-link"></span></a>Libraries used<a class="anchor-link" href="#Libraries-used"> </a>
</h1>
<ul>
<li>
<code>sklearn.datasets.load_iris</code>: To load iris dataset. Iris dataset comes built into Sklearn</li>
<li>
<code>sklearn.model_selection.train_test_split</code> : To split the data into train and test set</li>
<li>
<code>numpy</code>: Use numpy arrays to create neural network layers</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Loading-dataset">
<a class="anchor" href="#Loading-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading dataset<a class="anchor-link" href="#Loading-dataset"> </a>
</h1>
<p>we will load Iris dataset from sklearn's built in dataset</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span>  <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">as_frame</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">X</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span><span class="n">y</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(array([[5.1, 3.5, 1.4, 0.2],
        [4.9, 3. , 1.4, 0.2],
        [4.7, 3.2, 1.3, 0.2],
        [4.6, 3.1, 1.5, 0.2],
        [5. , 3.6, 1.4, 0.2],
        [5.4, 3.9, 1.7, 0.4],
        [4.6, 3.4, 1.4, 0.3],
        [5. , 3.4, 1.5, 0.2],
        [4.4, 2.9, 1.4, 0.2],
        [4.9, 3.1, 1.5, 0.1]]),
 array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0]))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Train-Test-split">
<a class="anchor" href="#Train-Test-split" aria-hidden="true"><span class="octicon octicon-link"></span></a>Train Test split<a class="anchor-link" href="#Train-Test-split"> </a>
</h1>
<p>We will split the data into 70:30 ratio where we will use 70% of data for training our model and rest 30% for evaluating our model afterwards</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_X</span><span class="p">,</span><span class="n">test_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span><span class="n">test_y</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Neural-Network--Layers">
<a class="anchor" href="#Neural-Network--Layers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Neural Network  Layers<a class="anchor-link" href="#Neural-Network--Layers"> </a>
</h1>
<p>We define the layers which are required by our model. Each layer has a forward pass and backward pass.In forward pass we will compute the output of the network given the input data and in the backward pass we will compute the gradient for the layer with respect to loss.</p>
<h2 id="Linear-Layer">
<a class="anchor" href="#Linear-Layer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Linear Layer<a class="anchor-link" href="#Linear-Layer"> </a>
</h2>
<p><strong>Forward Pass</strong>
$$
L=X.W^{T}+b_{1}
$$</p>
<p><strong>Backward Pass</strong></p>
<p>Gradient for W.r.t W:
$$
\frac{\partial L}{\partial W}=\frac{\partial L}{\partial Y}^{T} . X 
$$
Gradient for W.r.t b:
$$
\frac{\partial L}{\partial b_{1}}=\frac{\partial L}{\partial Y}^{T}
$$
Gradient for W.r.t X:
$$
\frac{\partial L}{\partial X}=\frac{\partial L}{\partial Y} . W 
$$</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Linear</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">in_features</span><span class="p">,</span><span class="n">out_features</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"value"</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">"grad"</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"value"</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">"grad"</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="s2">"value"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,(</span><span class="n">out_features</span><span class="p">,</span><span class="n">in_features</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="s2">"grad"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,(</span><span class="n">out_features</span><span class="p">,</span><span class="n">in_features</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">bias</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"value"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,(</span><span class="n">out_features</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"grad"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,(</span><span class="n">out_features</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"value"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">out_features</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"grad"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">out_features</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inp</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        inp: [#_samples,in_fetures]</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inp</span> <span class="o">=</span> <span class="n">inp</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="s2">"value"</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"value"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">grad</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        grad : shape(#,out_feat) [same as the return of forward]</span>
<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="s2">"grad"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">inp</span> <span class="p">)</span>  <span class="c1"># (out,in) = (out,#)(#,in)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"grad"</span><span class="p">]</span> <span class="o">=</span> <span class="n">grad</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                 <span class="c1"># (out) = (out)</span>

        <span class="n">inp_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="s2">"value"</span><span class="p">])</span>   <span class="c1"># (#,in) = (#,out)(out,in)</span>

        <span class="k">return</span> <span class="n">inp_grad</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Relu-Activation">
<a class="anchor" href="#Relu-Activation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Relu Activation<a class="anchor-link" href="#Relu-Activation"> </a>
</h1>
<p><strong>forward pass</strong></p>
$$
R(x)=\max (0, x)
$$<p><strong>backward pass</strong></p>
<p>Gradient for W.r.t X:
$$
\frac{\partial L}{\partial X}=R(X) \frac{\partial L}{\partial Y}
$$</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Relu</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inp</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inp</span> <span class="o">=</span> <span class="n">inp</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inp</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">grad</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        grad : [same as the inp]</span>
<span class="sd">        """</span>
        <span class="n">inp_grad</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inp</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">grad</span>
        <span class="k">return</span> <span class="n">inp_grad</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Loss-function">
<a class="anchor" href="#Loss-function" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loss function<a class="anchor-link" href="#Loss-function"> </a>
</h1>
<p>We will use Cross Entropy as our loss function as we are dealing with multi-class classification problem</p>
$$
L=-\frac{1}{m} \sum_{i=1}^{m} y_{i} \cdot \log \left(\hat{y}_{i}\right)
$$
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CrossEntropy</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span><span class="p">;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">Softmax</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">exps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exps</span><span class="o">/</span><span class="n">exps</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        pred: (#,num_target)</span>
<span class="sd">        target: (#,1)</span>
<span class="sd">        """</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># take softmax along col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

        <span class="n">log_likelihood</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">log_likelihood</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">m</span>
        <span class="k">return</span> <span class="n">loss</span>

    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">grad</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        grad : [same as the inp]</span>
<span class="sd">        """</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># take softmax along col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span> <span class="o">-=</span> <span class="n">grad</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad</span><span class="o">/</span><span class="n">m</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Model-Class">
<a class="anchor" href="#Model-Class" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model Class<a class="anchor-link" href="#Model-Class"> </a>
</h1>
<p>We will also create a model class that will wrap our training and testing logic. This is so that we have a clean api to work with inside our training loop</p>
<p><code>fit</code> : To train the network</p>
<p><code>evaluate</code>: To evaulate</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">loss_func</span><span class="p">,</span><span class="n">learning_rate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">loss_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">learning_rate</span>  
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        
        <span class="c1"># forward pass </span>
        <span class="n">pred_logits</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span><span class="n">curr</span><span class="p">:</span> <span class="n">curr</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">acc</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># calculate loss</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">pred_logits</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="c1"># backward pass</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span><span class="n">curr</span><span class="p">:</span> <span class="n">curr</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">acc</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># update weights</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">Linear</span><span class="p">):</span>
                <span class="n">l</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="s2">"value"</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="o">*</span><span class="n">l</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="s2">"grad"</span><span class="p">]</span>
                <span class="n">l</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"value"</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="o">*</span><span class="n">l</span><span class="o">.</span><span class="n">bias</span><span class="p">[</span><span class="s2">"grad"</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">loss</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="n">pred_logits</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span><span class="n">curr</span><span class="p">:</span> <span class="n">curr</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">acc</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_logits</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Score-function/metric">
<a class="anchor" href="#Score-function/metric" aria-hidden="true"><span class="octicon octicon-link"></span></a>Score function/metric<a class="anchor-link" href="#Score-function/metric"> </a>
</h1>
<p>We will use Accuracy as out Score function to see how well our model performed on our data.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">CrossEntropy</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">pred</span><span class="o">==</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Training-Loop">
<a class="anchor" href="#Training-Loop" aria-hidden="true"><span class="octicon octicon-link"></span></a>Training Loop<a class="anchor-link" href="#Training-Loop"> </a>
</h1>
<p><strong>Model</strong></p>
<ol>
<li>Linear(4,100)</li>
<li>Relu</li>
<li>Linear(100,3)</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">Relu</span><span class="p">(),</span>
    <span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>

<span class="n">loss_function</span> <span class="o">=</span> <span class="n">CrossEntropy</span><span class="p">()</span>  <span class="c1"># Loss function</span>
<span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span>  <span class="c1"># Learning Rate</span>
<span class="n">my_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">loss_function</span><span class="p">,</span><span class="n">lr</span><span class="p">)</span>  <span class="c1"># initialize model</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># epochs to train</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">epochs</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="n">loss</span> <span class="o">=</span> <span class="n">my_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span><span class="n">train_y</span><span class="p">)</span> <span class="c1"># train</span>
    
    <span class="n">pred_logits</span> <span class="o">=</span> <span class="n">my_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">train_X</span><span class="p">)</span> <span class="c1"># get predictions</span>
    
    <span class="c1"># print Loss and accuracy every 50 epochs</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">50</span>==0:
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Loss at epoch </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">  :</span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">, accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred_logits</span><span class="p">,</span><span class="n">train_y</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loss at epoch 50  :2.0528926556788556, accuracy: 0.3523809523809524
Loss at epoch 100  :0.5423031512767295, accuracy: 0.8666666666666667
Loss at epoch 150  :0.3816058479761151, accuracy: 0.9523809523809523
Loss at epoch 200  :0.3243114702106764, accuracy: 0.9619047619047619
Loss at epoch 250  :0.29193951765336557, accuracy: 0.9619047619047619
Loss at epoch 300  :0.2691038630894149, accuracy: 0.9619047619047619
Loss at epoch 350  :0.2515483517334566, accuracy: 0.9714285714285714
Loss at epoch 400  :0.23765863708233953, accuracy: 0.9714285714285714
Loss at epoch 450  :0.22612454813203908, accuracy: 0.9714285714285714
Loss at epoch 500  :0.21635705475306402, accuracy: 0.9714285714285714
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Evaluation-on-test-set">
<a class="anchor" href="#Evaluation-on-test-set" aria-hidden="true"><span class="octicon octicon-link"></span></a>Evaluation on test set<a class="anchor-link" href="#Evaluation-on-test-set"> </a>
</h1>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">my_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Accuracy for the test set: </span><span class="si">{</span><span class="n">accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test_y</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Accuracy for the test set: 0.8666666666666667
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="isbhargav/portfolio"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/portfolio/jupyter/neural-network/numpy/2021/01/18/multi-class-classification.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/portfolio/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/portfolio/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/portfolio/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Portfolio Website</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/isbhargav.github.com" title="isbhargav.github.com"><svg class="svg-icon grey"><use xlink:href="/portfolio/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/twitter.com%2Fbhargavlad" title="twitter.com/bhargavlad"><svg class="svg-icon grey"><use xlink:href="/portfolio/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
